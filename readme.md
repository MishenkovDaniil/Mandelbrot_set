# Оптимизация вычислений на примере вычисления цвета пикселей множества Мандельброта

***Целью данной работы является ускорение вычислений, проводимых с каждым пикселем, за счет параллелизации работы процессора с ними и анализ полученных коэффициентов ускорения.***

![](/mandelbrot_set.png?raw=true "Пример выводимого изображения")


## Версии программы
Всего было написано 4 программы, осуществляющие преобразования пикселей как в Мандельбротовом множестве.

1. Начальная, не оптимизированная версия([not_optimized_link](/mandelbrot.cpp)), в которой алгоритм отрисовки не оптимизирован и каждая его итерация обрабатывает 1 пиксель.
2. Псевдо-оптимизированные версии:

   2.1. В первой такой версии ([pseudo_optimized_link](/mandelbrot_pseudo_optmzd_1.cpp)) мы производим попытку распараллеливания за счет использования for-циклов для работы с 4 пикселями вместо одного на каждой итерации.

   2.2. Во второй версии ([pseudo_optimized_link](/mandelbrot_pseudo_optmzd_2.cpp)) также используются for-циклы, но все они помещены во встраиваемые (inline) функции, для того чтобы оптимизатору было проще определить место, в котором есть возможности для распараллеливания вычислений.

3. Оптимизированная версия ([optimized_version_link](/mandelbrot_optmzd_3.cpp)), в которой распараллеливание команд осуществляется с помощью прямого указания процессору на это путем использования интринсик-функции. В нашем случае используются SSE инструкции для работы со 128-битными XMM регистрами, что тем самым позволяет обрабатывать по 4 пикселя(размером в 4 байта) одновременно.

Замечание: Псевдо-оптимизированные версии получили такое название, так как гипотеза распараллеливания встроенным оптимизатором за счет наших преобразований кода не подтвердилась.


## Время работы

Некоторые важные замечания:

- FPS во время работы программы измерялся как обратная величина ко времени работы программы в секундах:

$$fps = \frac {1}{work.time},$$

где под временем работы программы (work.time) подразумевается время, потраченное на вычисления, с которыми проводилась оптимизация.

- Cреднее время измерялось посредством многократного запуска программы и усреднения результатов (100 запусков в случаях начальной и оптимизированной версии).

- Все версии программы запускались с флагом оптимизации -O3.


| Версия                            | FPS   | Коэффициент ускорения (%) |
| -------------------------         | ----- | ------------------------- |
| Не оптимизированная               | 1.65  |           1               |
| Псевдо-оптимизированная (первая)  | 0.13  |    0.08                   |       
| Псевдо-оптимизированная (вторая)  | 0.12  |    0.07                   |  
| Оптимизированная                  | 2.83  |    1.72                   |


## Анализ результатов
- Распараллеливание (с последующим ускорением программы) за счет использования циклов и встраиваемых функции не всегда возможно, а в нашем случае оно даже приводит к заметному торможению программы.
- Использование функций-интринсиков действительно помогает ускорить программу, в которой возможна обработка нескольких одинаковых по размеру независимых объектов.
- Накладные расходы не позволяют ускорить программу с помощью интринсиков абсолютно (т.е. обрабатывая по 4 пикселя в XMM регистрах невозможно получить ускорение вычислений, проводимых с их помощью, в 4 раза).

